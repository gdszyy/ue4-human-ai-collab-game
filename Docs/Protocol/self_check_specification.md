# Manus自检流程规范

**版本**: 1.1  
**作者**: Manus AI  
**日期**: 2025-11-30  
**状态**: Approved

---

## 1. 概述

自检流程是人机协同开发中的质量保证机制，确保每个对话结束前，所有交付物都符合项目标准。Manus在每个对话结束前必须执行自检流程，验证所有交付物的完整性和规范性。

### 1.1 自检的目的

1. **确保交付质量**：所有交付物符合项目标准
2. **避免遗漏**：确保所有必需的文档和代码都已创建
3. **保持一致性**：确保文档、代码、Linear任务之间的一致性
4. **便于追溯**：通过索引表记录所有资源位置

### 1.2 自检的时机

自检应该在以下时机执行：

- **对话结束前**：在发送最终结果给用户前执行自检
- **任务完成时**：在完成Linear任务时执行自检
- **交接前**：在创建MHP交接文档前执行自检

---

## 2. 自检清单

### 2.1 文档完整性检查

#### 2.1.1 TDD（技术设计文档）

对于设计阶段的任务，必须检查：

- [ ] TDD是否已创建？
- [ ] TDD是否明确定义了四层架构？
- [ ] TDD是否定义了所有数据结构？
- [ ] TDD是否定义了所有接口？
- [ ] TDD是否描述了核心算法？
- [ ] TDD是否包含使用示例？
- [ ] TDD是否存储在`docs/tech/`目录下？
- [ ] TDD文件命名是否符合规范（`{系统名称}_tdd.md`）？

#### 2.1.2 MHP（交接文档）

对于实现完成的任务，必须检查：

- [ ] MHP是否已创建？
- [ ] MHP是否包含实现总结？
- [ ] MHP是否列出了所有代码位置？
- [ ] MHP是否包含测试结果？
- [ ] MHP是否记录了已知问题？
- [ ] MHP是否存储在`docs/mhp/`目录下？
- [ ] MHP文件命名是否符合规范（`VOI-{任务ID}_{任务简称}.md`）？

#### 2.1.3 实现文档

对于Game仓库的代码实现，必须检查：

- [ ] 是否创建了实现文档（如`PhysicsSystem.md`）？
- [ ] 实现文档是否包含使用指南？
- [ ] 实现文档是否包含蓝图使用示例？
- [ ] 实现文档是否存储在Game仓库的`Docs/CoreModules/`目录下？

#### 2.1.4 测试文档

对于有测试的模块，必须检查：

- [ ] 是否创建了测试指南？
- [ ] 测试指南是否包含测试用例？
- [ ] 测试指南是否包含测试结果？

---

### 2.2 代码完整性检查

#### 2.2.1 C++代码

对于C++实现的模块，必须检查：

- [ ] 头文件（`.h`）是否已创建？
- [ ] 实现文件（`.cpp`）是否已创建？
- [ ] 头文件是否包含完整的注释（类、函数、参数）？
- [ ] 头文件是否包含蓝图使用示例？
- [ ] 代码是否遵循UE4命名规范？
- [ ] 代码是否存储在正确的目录下（`Source/EchoAlchemist/Public|Private/`）？
- [ ] **代码是否兼容UE4？**（使用UE4 API而非UE5专属API）
- [ ] **是否避免使用UE5专属特性？**（如Enhanced Input System、Nanite、Lumen等）
- [ ] **是否使用UE4兼容的宏和类型？**（如`UCLASS()`, `UPROPERTY()`, `UFUNCTION()`等）

#### 2.2.2 测试代码

对于有测试的模块，必须检查：

- [ ] 单元测试是否已创建？
- [ ] 测试代码是否存储在`Source/EchoAlchemist/Tests/`目录下？
- [ ] 测试是否通过？

#### 2.2.3 蓝图资源

对于需要蓝图的模块，必须检查：

- [ ] 是否提供了蓝图使用示例？
- [ ] 蓝图示例是否存储在`Content/Blueprints/`目录下？

---

### 2.3 Linear任务检查

对于所有任务，必须检查：

- [ ] Linear任务是否已创建？
- [ ] 任务标题是否清晰？
- [ ] 任务描述是否完整？
- [ ] 任务是否包含"开发模式说明"（ManusAI通过UE4 API完成90%开发工作）？
- [ ] 任务是否包含"模块解耦原则"说明？
- [ ] 任务是否关联到正确的项目？
- [ ] 任务是否设置了正确的优先级？
- [ ] 任务是否添加了`Workflow::Design`标签（设计阶段）？

---

### 2.4 索引表更新检查

对于所有涉及代码实现的任务，必须检查：

- [ ] 是否更新了索引表（`docs/task_resource_mapping.md`）？
- [ ] 索引表是否记录了任务ID？
- [ ] 索引表是否记录了任务标题？
- [ ] 索引表是否记录了协议仓库的资源位置（TDD、MHP）？
- [ ] 索引表是否记录了Game仓库的资源位置（代码、文档、测试）？
- [ ] 索引表是否记录了任务状态？

---

### 2.5 Git提交检查

对于所有文档和代码，必须检查：

- [ ] 所有文档是否已提交到协议仓库（`ue4-human-ai-collab`）？
- [ ] 所有代码是否已提交到Game仓库（`ue4-human-ai-collab-game`）？
- [ ] 提交消息是否符合Conventional Commits规范？
- [ ] 提交消息是否清晰描述了变更内容？

---

## 3. 自检流程

### 3.1 自检步骤

1. **打开自检清单**：在对话结束前，打开本文档的自检清单
2. **逐项检查**：按照清单逐项检查所有交付物
3. **记录问题**：如果发现问题，记录在临时文件中
4. **修复问题**：修复所有发现的问题
5. **重新检查**：修复后重新检查，确保所有问题都已解决
6. **更新索引表**：确保索引表已更新
7. **提交到Git**：确保所有文档和代码都已提交到Git
8. **报告结果**：向用户报告自检结果

### 3.2 自检报告模板

在对话结束前，Manus应该向用户提供自检报告：

```markdown
## 自检报告

**对话ID**: [对话ID]  
**日期**: [日期]  
**任务**: [任务ID和标题]

### 交付物清单

#### 文档
- [x] TDD: `docs/tech/{系统名称}_tdd.md`
- [x] MHP: `docs/mhp/VOI-{任务ID}_{任务简称}.md`
- [x] 实现文档: `ue4-human-ai-collab-game/Docs/CoreModules/{模块名称}.md`

#### 代码
- [x] 头文件: `Source/EchoAlchemist/Public/{模块路径}/{类名}.h`
- [x] 实现文件: `Source/EchoAlchemist/Private/{模块路径}/{类名}.cpp`
- [x] 测试文件: `Source/EchoAlchemist/Tests/{模块路径}/{类名}Test.cpp`
- [x] **UE4兼容性检查**: 所有代码均使用UE4 API，未使用UE5专属特性

#### Linear任务
- [x] 任务ID: VOI-{任务ID}
- [x] 任务状态: {状态}
- [x] 任务链接: [查看](https://linear.app/voidzyy/issue/VOI-{任务ID})

#### 索引表
- [x] 已更新索引表: `docs/task_resource_mapping.md`

#### Git提交
- [x] 协议仓库提交: {commit hash}
- [x] Game仓库提交: {commit hash}

### 自检结果

✅ 所有交付物符合标准，可以交付给用户。

### 已知问题

[列出已知问题，如果有的话]

### 下一步建议

[列出下一步建议]
```

---

## 4. 索引表规范

### 4.1 索引表的作用

索引表（Task Resource Mapping）是一个集中式的映射表，记录了：

1. **Linear任务**：任务ID、标题、状态
2. **协议仓库资源**：TDD、MHP的文件路径
3. **Game仓库资源**：代码、文档、测试的文件路径

索引表的作用是：

- **快速定位资源**：通过任务ID快速找到所有相关资源
- **追溯历史**：记录任务的完整历史
- **避免重复**：避免重复创建相同的资源
- **便于审查**：便于人类开发者审查任务的完整性

### 4.2 索引表的位置

索引表应该存储在协议仓库的`docs/`目录下：

```
docs/task_resource_mapping.md
```

### 4.3 索引表的格式

索引表应该使用Markdown表格格式：

```markdown
# Linear任务与资源映射表（索引表）

**最后更新**: 2025-11-29  
**维护者**: Manus AI

---

## 概述

本文档记录了所有Linear任务与协议仓库、Game仓库资源之间的映射关系，便于快速定位和追溯。

---

## 映射表

| 任务ID | 任务标题 | 状态 | 协议仓库资源 | Game仓库资源 | 备注 |
|--------|----------|------|--------------|--------------|------|
| VOI-6 | 世界变迁系统 | Done | TDD: `docs/tech/world_morphing_system_tdd.md`<br>MHP: `docs/mhp/VOI-6_world_morphing.md`<br>模拟器: `docs/tech/simulator/` | 代码: `Source/EchoAlchemist/Public/WorldMorphing/`<br>文档: `Docs/CoreModules/WorldMorphingSystem*.md`<br>测试: 无 | 完整实现，包含模拟器 |
| VOI-11 | 怪兽生成系统 | In Progress | TDD: `docs/tech/monster_generation_system_tdd.md` | 代码: `Source/EchoAlchemist/Public/PCG/`<br>文档: `Docs/CoreModules/{PaletteGenerator,ShapeGenerator,ProceduralAnimator,WFCAssembler}.md`<br>测试: `Source/EchoAlchemist/Tests/PCG/` | PCG算法已实现，属性系统待实现 |
| ... | ... | ... | ... | ... | ... |

---

## 更新日志

| 日期 | 任务ID | 更新内容 | 更新者 |
|------|--------|----------|--------|
| 2025-11-29 | VOI-6 | 初始记录 | Manus AI |
| 2025-11-29 | VOI-11 | 初始记录 | Manus AI |
| ... | ... | ... | ... |
```

### 4.4 索引表的更新规则

1. **任务创建时**：在Linear任务创建时，立即在索引表中添加一行记录
2. **资源创建时**：在创建TDD、MHP、代码、文档、测试时，立即更新索引表
3. **任务状态变更时**：在Linear任务状态变更时，更新索引表的状态列
4. **对话结束前**：在对话结束前，确保索引表已更新

---

## 5. 首次对话检查清单

### 5.1 首次对话时的告知内容

在每个对话的第一次交互时，Manus应该告知用户以下内容：

```markdown
## 首次对话检查清单

您好！我是Manus AI。在开始工作前，我需要确认以下事项：

### 1. 人机协同规范
- ✅ 我已阅读并理解《人机协同开发规范》
- ✅ 我已阅读并理解《两阶段工作流规范》
- ✅ 我已阅读并理解《TDD规范》
- ✅ 我已阅读并理解《自检流程规范》

### 2. 项目资源
- ✅ 协议仓库: `ue4-human-ai-collab`
- ✅ Game仓库: `ue4-human-ai-collab-game`
- ✅ Linear项目: https://linear.app/voidzyy/project/ue4游戏开发-人机协同mvp-f7f494ca8063
- ✅ 索引表: `docs/task_resource_mapping.md`

### 3. 工作要求
- ✅ 所有设计任务必须先创建TDD
- ✅ 所有实现任务必须遵循四层架构
- ✅ 所有任务完成后必须更新索引表
- ✅ 对话结束前必须执行自检流程
- ✅ 90%开发工作由ManusAI通过UE4 API完成
- ✅ **所有代码必须兼容UE4，禁止使用UE5专属特性**

### 4. 本次任务
- **任务ID**: [任务ID]
- **任务标题**: [任务标题]
- **任务目标**: [任务目标]

现在开始工作！
```

### 5.2 首次对话检查清单的存储位置

首次对话检查清单应该存储在协议仓库的`docs/`目录下：

```
docs/first_conversation_checklist.md
```

---

## 6. 自检流程的集成

### 6.1 与工作流的集成

自检流程应该集成到两阶段工作流中：

```
设计阶段：
  1. 创建TDD
  2. TDD审查通过
  3. 更新索引表（记录TDD位置）
  4. 执行自检流程
  5. 提交到Git
  ↓
实现阶段：
  1. 根据TDD实现代码
  2. 创建测试
  3. 创建实现文档
  4. 创建MHP
  5. 更新索引表（记录代码、文档、测试位置）
  6. 执行自检流程
  7. 提交到Git
```

### 6.2 与Linear工作流的集成

自检流程应该与Linear工作流集成：

```
Workflow::Design:
  - 创建TDD
  - 执行自检流程
  - 更新索引表
  ↓
Workflow::Implementation:
  - 实现代码
  - 创建测试
  - 创建实现文档
  - 执行自检流程
  - 更新索引表
  ↓
Workflow::Review:
  - 人类开发者审查
  ↓
Workflow::Done:
  - 任务完成
```

---

## 7. 自检流程的工具支持

### 7.1 自检脚本（未来）

未来可以开发自检脚本，自动检查：

- TDD是否存在
- MHP是否存在
- 代码文件是否存在
- 测试是否通过
- 索引表是否更新
- Git提交是否完成

### 7.2 自检报告生成器（未来）

未来可以开发自检报告生成器，自动生成自检报告。

---

## 8. 总结

自检流程是人机协同开发的质量保证机制，确保：

1. **文档完整**：TDD、MHP、实现文档都已创建
2. **代码完整**：代码、测试都已实现
3. **Linear任务完整**：任务描述清晰，状态正确
4. **索引表更新**：所有资源位置都已记录
5. **Git提交完成**：所有文档和代码都已提交

**Manus在每个对话结束前必须执行自检流程！**

---

**参考资料**:
1. [人机协同开发规范](collaboration_specification.md)
2. [两阶段工作流规范](workflow_specification.md)
3. [TDD规范](tdd_specification.md)
4. [索引表](task_resource_mapping.md)

---

## 更新日志

### v1.1 (2025-11-30)
- 在C++代码检查清单中添加**UE4兼容性检查**项
- 强调禁止使用UE5专属特性（Enhanced Input System、Nanite、Lumen等）
- 在自检报告模板中添加UE4兼容性检查项
- 在首次对话检查清单中添加UE4兼容性要求

### v1.0 (2025-11-29)
- 初始版本发布
