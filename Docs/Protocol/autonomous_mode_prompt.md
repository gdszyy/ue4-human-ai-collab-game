# 自主模式提示词

**版本**: 1.1  
**最后更新**: 2025-11-29  
**作者**: Manus AI

---

## 概述

自主模式提示词允许Manus在没有明确任务指定的情况下，自主选择任务、了解进度、完成工作。这种模式适合让Manus持续推进项目，无需人工干预每个任务的启动。

---

## 自主模式提示词

```
你好，我需要你作为"自主开发者Manus"以自主模式工作。

请严格按照以下步骤执行：

**第一步：环境准备**
1. 克隆GitHub仓库：
   - 协议仓库：`gh repo clone gdszyy/ue5-human-ai-collab`
   - Game仓库：`gh repo clone gdszyy/ue5-human-ai-collab-game`

2. 阅读核心规范文档（协议仓库`docs/`目录）：
   - `docs/README.md` - 文档目录结构说明
   - `docs/collaboration_specification.md` - 人机协同开发规范
   - `docs/workflow_specification.md` - 两阶段工作流规范
   - `docs/tdd_specification.md` - TDD规范
   - `docs/self_check_specification.md` - 自检流程规范
   - `docs/first_conversation_checklist.md` - 首次对话检查清单
   - `docs/cpp_blueprint_workflow.md` - C++核心模块+蓝图连接开发模式
   - `docs/task_resource_mapping.md` - 索引表

**第二步：任务选择**
1. 使用Linear MCP工具列出所有任务：
   ```bash
   manus-mcp-cli tool call list_issues --server linear --input '{"project_id": "f7f494ca8063"}'
   ```

2. 根据以下优先级规则选择任务：
   - **优先级顺序**：Urgent > High > Medium > Low
   - **状态过滤**：**必须排除状态为"In Progress"的任务**（避免多个对话同时接取同一任务），优先选择"Backlog"或"Todo"状态的任务
   - **依赖检查**：确保所选任务的依赖任务已完成
   - **能力匹配**：选择你当前能力范围内的任务

3. 选定任务后，**立即将任务状态更新为"In Progress"**（锁定任务，防止其他对话接取）：
   ```bash
   manus-mcp-cli tool call update_issue --server linear --input '{"issue_id": "{选定的任务ID}", "state": "In Progress"}'
   ```

4. 获取任务详情：
   ```bash
   manus-mcp-cli tool call get_issue --server linear --input '{"issue_id": "{选定的任务ID}"}'
   ```

**第三步：锁定任务**
将任务状态更新为"In Progress"，防止其他对话接取同一任务。

**第四步：任务上下文同步**
1. 在索引表（`docs/task_resource_mapping.md`）中查找任务资源：
   - 查看任务是否有TDD、MHP、代码实现
   - 记录所有相关资源的位置

2. 阅读任务相关文档：
   - 如果有TDD，阅读`docs/tech/{系统名称}_tdd.md`
   - 如果有MHP，阅读`docs/mhp/{任务ID}_{任务简称}.md`
   - 如果有交接文档，阅读`docs/handover/{任务ID}_handover.md`

3. 查看Game仓库的现有实现：
   - 根据索引表中的路径，查看已实现的代码
   - 了解当前实现进度和待完成工作

4. 如果需要，阅读游戏设计文档（GDD）：
   ```bash
   manus-mcp-cli tool call notion-fetch --server notion --input '{"page_id": "2b8bacf5f26781c0b16ccec48d9750cc"}'
   ```
   注意：仅关注核心机制，忽略剧情部分。

**第五步：执行首次对话检查清单**
按照`docs/first_conversation_checklist.md`，确认：
- ✅ 已理解所有人机协同规范
- ✅ 已确认所有项目资源位置
- ✅ 已明确选定任务的工作要求
- ✅ 已确认任务的ID、标题、目标、阶段、优先级

**第六步：向我确认并开始工作**
使用以下模板向我确认：

```markdown
## 自主模式任务确认

我已完成环境准备和任务选择，现在准备开始工作。

### 选定的任务
- **任务ID**: {任务ID}
- **任务标题**: {任务标题}
- **任务优先级**: {优先级}
- **任务状态**: {当前状态}
- **任务目标**: {任务目标}

### 任务上下文
- **TDD**: {是否存在，路径}
- **MHP**: {是否存在，路径}
- **现有实现**: {是否存在，简要描述}
- **依赖任务**: {依赖任务ID和状态}

### 工作计划
- **阶段**: {设计阶段 | 实现阶段 | 交接阶段}
- **预计工作量**: {预计天数}
- **主要交付物**: {列出主要交付物}

### 首次对话检查清单
- ✅ 已理解所有人机协同规范
- ✅ 已确认所有项目资源位置
- ✅ 已明确选定任务的工作要求

现在开始工作！
```

**第七步：执行任务**
根据任务阶段执行相应工作：

**如果是设计阶段**：
1. 创建TDD（`docs/tech/{系统名称}_tdd.md`）
2. TDD必须明确定义四层架构（数据层、模拟层、粘合层、视觉层）
3. 参考VOI-6和VOI-11的TDD作为最佳实践
4. 更新索引表，记录TDD位置
5. 将Linear任务状态更新为"In Progress"

**如果是实现阶段**：
1. 根据TDD实现C++代码
2. 创建测试
3. 创建实现文档（Game仓库`Docs/CoreModules/{模块名称}.md`）
4. 更新索引表，记录代码、文档、测试位置
5. 将Linear任务状态更新为"In Review"

**如果是交接阶段**：
1. 创建MHP（`docs/mhp/{任务ID}_{任务简称}.md`）
2. 创建交接文档（`docs/handover/{任务ID}_handover.md`）
3. 更新索引表
4. 将Linear任务状态更新为"Done"

**第八步：执行自检流程**
在任务完成前，按照`docs/self_check_specification.md`执行自检：
1. 文档完整性检查
2. 代码完整性检查
3. Linear任务检查
4. 索引表更新检查
5. Git提交检查

**第九步：生成自检报告并交接**
1. 生成自检报告
2. 更新索引表
3. 提交所有变更到Git
4. 向我报告任务完成情况

完成后，询问我是否继续以自主模式选择下一个任务。
```

---

## 自主模式工作流程图

```
开始
  ↓
环境准备（克隆仓库、阅读规范）
  ↓
任务选择（从Lin ear根据优先级选择，排除In Progress）
  ↓
锁定任务（更新状态为In Progress）
  ↓
任务上下文同步（索引表、TDD、MHP、代码）
  ↓
首次对话检查清单
  ↓
向用户确认任务
  ↓
执行任务（设计/实现/交接）
  ↓
自检流程
  ↓
生成自检报告并交接
  ↓
询问是否继续
  ↓
如果继续 → 返回“任务选择”
如果结束 → 结束
```

---

## 自主模式的优势

### 1. 无需人工指定任务
- Manus自主从Linear中选择任务
- 根据优先级和依赖关系智能选择
- 减少人工干预

### 2. 持续推进项目
- Manus可以连续完成多个任务
- 形成持续交付的工作流
- 提高开发效率

### 3. 完整的质量保证
- 每个任务都执行首次对话检查清单
- 每个任务都执行自检流程
- 确保交付质量

### 4. 完整的资源追溯
- 每个任务都更新索引表
- 所有资源位置都有记录
- 便于后续查找和维护

---

## 自主模式的适用场景

### 适用场景

1. **批量任务处理**：有多个优先级明确的任务需要完成
2. **持续开发**：需要Manus持续推进项目，无需频繁人工干预
3. **夜间工作**：让Manus在夜间自主工作，早上查看结果
4. **探索性开发**：让Manus自主探索和实现功能

### 不适用场景

1. **需要人工决策的任务**：涉及架构决策、技术选型等需要人工判断的任务
2. **高风险任务**：涉及核心系统重构、数据迁移等高风险操作
3. **需要实时反馈的任务**：需要频繁与人类开发者沟通的任务

---

## 自主模式的监控和控制

### 监控机制

1. **任务确认**：Manus在开始每个任务前都会向用户确认
2. **自检报告**：Manus在完成每个任务后都会生成自检报告
3. **Git提交**：所有变更都会提交到Git，便于审查

### 控制机制

1. **任务确认**：用户可以在任务确认时拒绝或调整任务
2. **中断机制**：用户可以随时中断Manus的工作
3. **审查机制**：用户可以审查Git提交，发现问题及时回滚

---

## 自主模式与三阶段提示词的关系

自主模式是三阶段提示词的补充，两者的关系如下：

| 维度 | 三阶段提示词 | 自主模式提示词 |
|------|-------------|---------------|
| **任务指定** | 人工指定任务ID | Manus自主选择任务 |
| **适用场景** | 单个任务的完整生命周期 | 批量任务的持续处理 |
| **人工干预** | 每个阶段都需要人工触发 | 仅在任务开始时需要确认 |
| **灵活性** | 高（可以随时调整） | 中（在任务开始前调整） |
| **效率** | 中（需要人工触发） | 高（持续工作） |

**建议**：
- **单个任务**：使用三阶段提示词，更灵活
- **批量任务**：使用自主模式提示词，更高效
- **混合使用**：可以先用自主模式批量处理简单任务，再用三阶段提示词处理复杂任务

---

## 示例：自主模式的完整对话

### 用户第一条消息

```
你好，我需要你作为"自主开发者Manus"以自主模式工作。

[使用上面的自主模式提示词]
```

### Manus的响应

```markdown
## 自主模式任务确认

我已完成环境准备和任务选择，现在准备开始工作。

### 选定的任务
- **任务ID**: VOI-12
- **任务标题**: 炼金配方系统 - 魔药组合与配方库
- **任务优先级**: Urgent
- **任务状态**: Backlog
- **任务目标**: 实现炼金配方系统，整合弹射药剂和魔法添加剂

### 任务上下文
- **TDD**: 不存在，需要创建
- **MHP**: 不存在
- **现有实现**: 不存在
- **依赖任务**: 无

### 工作计划
- **阶段**: 设计阶段
- **预计工作量**: 3-5天
- **主要交付物**: TDD、索引表更新、Linear任务状态更新

### 首次对话检查清单
- ✅ 已理解所有人机协同规范
- ✅ 已确认所有项目资源位置
- ✅ 已明确选定任务的工作要求

现在开始工作！
```

### 用户的响应

```
好的，开始吧！
```

### Manus开始工作

[Manus创建TDD、更新索引表、更新Linear任务状态...]

### Manus完成任务后

```markdown
## 任务完成报告

我已完成任务VOI-12的设计阶段工作。

### 交付物
- ✅ TDD: `docs/tech/alchemy_recipe_system_tdd.md`
- ✅ 索引表更新: 已记录TDD位置
- ✅ Linear任务状态: 已更新为"In Progress"
- ✅ Git提交: {commit hash}

### 自检报告
[完整的自检报告]

### 下一步
是否继续以自主模式选择下一个任务？
```

### 用户的响应

```
继续！
```

### Manus继续选择下一个任务

[Manus重复上述流程，选择下一个任务...]

---

## 最佳实践

### 1. 明确任务优先级

在Linear中为所有任务设置明确的优先级，确保Manus能够正确选择任务。

### 2. 维护任务依赖关系

在Linear中明确标注任务的依赖关系，避免Manus选择依赖未完成的任务。

### 3. 定期审查自检报告

定期审查Manus生成的自检报告，确保交付质量。

### 4. 定期审查Git提交

定期审查Manus的Git提交，发现问题及时回滚。

### 5. 合理控制自主模式的范围

不要让Manus在自主模式下处理高风险任务，这些任务应该使用三阶段提示词。

---

## 常见问题

### Q1: 如果Manus选择的任务不合适，怎么办？

A1: 在任务确认阶段，用户可以拒绝Manus选择的任务，并指定其他任务。例如：

```
我认为VOI-12不是当前最优先的任务，请选择VOI-18（打砖块核心战斗系统）。
```

### Q2: 如果Manus在自主模式下遇到问题，怎么办？

A2: Manus会在遇到问题时主动向用户报告，并请求帮助。用户可以：
1. 提供指导，帮助Manus解决问题
2. 中断自主模式，切换到三阶段提示词模式
3. 跳过当前任务，让Manus选择下一个任务

### Q3: 自主模式下，Manus会不会做出错误的决策？

A3: 自主模式下，Manus的决策基于明确的规则（优先级、依赖关系、能力匹配），但仍可能出现错误。因此：
1. Manus在开始每个任务前都会向用户确认
2. 用户可以在确认阶段拒绝或调整任务
3. 用户可以通过审查Git提交发现问题并及时回滚

### Q4: 自主模式下，如何确保Manus不会处理高风险任务？

A4: 建议在Linear中为高风险任务添加特殊标签（如"High Risk"），并在自主模式提示词中明确指示Manus跳过这些任务。

---

**参考资料**:
1. [三阶段提示词模板体系](three_stage_prompt_templates.md)
2. [人机协同开发规范](collaboration_specification.md)
3. [自检流程规范](self_check_specification.md)
4. [首次对话检查清单](first_conversation_checklist.md)
5. [索引表](task_resource_mapping.md)
