# 人机协同开发规范 (Human-AI Collaborative Development Specification)
版本: 1.0 | 最后更新: 2025-11-28

## 1. 核心原则：外部化状态管理
本规范的核心是“外部化状态管理”原则。项目的“记忆”和“状态”不依赖于任何临时的对话历史，而是持久化地存储在指定的外部工具中。这确保了任何协作者（无论是人类还是AI）在任何时候都能获取到项目的完整、实时上下文。
- 对话是临时的指令通道。
- Jira, Git, Notion 是持久的“项目大脑”。

## 2. 工具链与单一可信源 (Single Source of Truth)
<table header-row="true">
	<tr>
		<td>**工具**</td>
		<td>**角色**</td>
		<td>**核心职责**</td>
	</tr>
	<tr>
		<td>Jira</td>
		<td>“要做什么？” (What)</td>
		<td>管理所有任务、需求、Bug和项目进度。是任务状态的唯一权威来源。</td>
	</tr>
	<tr>
		<td>Git (GitHub)</td>
		<td>“已经做了什么？” (How)</td>
		<td>管理所有代码和项目文件。是项目技术实现的唯一权威来源。</td>
	</tr>
	<tr>
		<td>Notion</td>
		<td>“为什么这么做？” (Why)</td>
		<td>存储设计文档、技术决策、会议纪要等知识。是项目设计和决策背景的唯一权威来源。</td>
	</tr>
	<tr>
		<td>CI/CD (GitHub Actions)</td>
		<td>“做得对不对？” (Validation)</td>
		<td>自动化构建、测试和部署流程，验证代码质量和项目可运行性。</td>
	</tr>
</table>

## 4. 交付物沉淀规则

所有在开发过程中产生的交付物，都必须按照统一的规范沉淀到GitHub仓库的`docs/`目录中，以确保知识的完整性和可追溯性。

### 4.1. 目录结构

```
docs/
├── README.md                             # 文档目录结构说明
├── collaboration_specification.md        # 人机协同开发规范
├── workflow_specification.md             # 两阶段工作流规范
├── mhp_template.md                       # MHP模板
├── tool_comparison_report.md             # 工具对比报告
├── tech/                                 # 技术设计文档目录
│   └── (TDD文档存放于此)
├── mhp/                                  # MHP存档目录
│   └── (MHP文档存放于此)
└── reports/                              # 测试报告和分析文档
    └── (性能测试报告等存放于此)
├── handover/                             # 交接文档目录
    └── (交接文档存放于此)
```

### 4.2. 核心原则

1. **所有交付物必须提交到GitHub仓库**，而不是仅保存在本地或Notion。
2. **MHP必须按任务ID归档**到`mhp/`目录，便于后续查找和追溯。
3. **技术文档必须分类存放**，保持清晰的信息架构。
4. **文件命名必须遵循规范**，使用小写字母和下划线分隔。

详细的目录结构和命名规范，请参考`docs/README.md`文件。

---

## 5. 标准工作流
1. **需求规划**: 项目总监（您）与“管理者Manus”通过对话，参考Notion文档，共同规划需求。
2. **任务创建与交接**: “管理者Manus”在Jira中创建/更新Epics和Stories，并生成一份“Manus工作交接协议(MHP)”附加到Jira Epic的评论中。
3. **任务分配**: 您通过新对话向“开发者Manus”分配一个具体的Jira任务ID。
4. **上下文同步**: “开发者Manus”通过Jira任务ID，回溯到Epic并读取MHP，同步完整的任务、技术和设计上下文。
5. **开发执行**: “开发者Manus”基于同步的上下文，在新的Git分支上进行开发。
6. **代码提交**: 完成后，提交代码并创建Pull Request。提交信息必须关联Jira任务ID。
7. **自动化验证**: CI/CD系统自动编译和测试该PR。
8. **审核与合并**: 您审核代码和测试结果，批准并合并PR。
9. **任务关闭**: Jira任务状态根据PR的合并被自动更新为“完成”。

## 6. 规范标准
### 6.1. Git规范
**分支命名**:
- `feature/[JIRA-ID]-[description]` (新功能)
- `bugfix/[JIRA-ID]-[description]` (Bug修复)
- `refactor/[JIRA-ID]-[description]` (代码重构)

**提交信息 (Commit Message):**
```plaintext
<type>(<scope>): <subject>

<body>

Ref: <JIRA-ID>
```
示例: `feat(player): implement basic jump mechanic. Ref: PROJ-123`

### 6.2. Jira规范
- **Epic**: 代表一个大的功能模块或用户故事，如“核心战斗系统”。
- **Story**: 代表一个可交付的用户价值，隶属于一个Epic，如“玩家可以进行二段跳”。
- **Task**: 代表一个没有直接用户价值的技术任务，如“搭建CI/CD环境”。
- **Bug**: 代表一个缺陷或错误。

### 6.3. 交接文档规范

为了确保跨对话的任务交接能够顺畅进行，每次会话结束时，都必须生成一份交接文档，并归档到`docs/handover/`目录。

### 6.3.1. 交接文档 (Handover Document)

**命名规范**: `VOI-{任务ID}_handover.md`  
**示例**: `VOI-6_handover.md`

**核心内容**：
- **核心指令**: 明确下一位Manus的角色和首要职责
- **上下文加载指南**: 详细说明如何从GitHub仓库加载规范文档
- **当前任务分配**: 指定任务ID和任务链接
- **任务目标**: 说明需要与用户讨论的技术方案
- **预期产出**: 明确需要创建的交付物和更新的任务状态
- **关键资源**: 提供GDD、附录和MHP的链接

### 6.3.2. Manus工作交接协议 (MHP)

MHP是“管理者Manus”在完成一次规划会话后，必须生成的结构化文档。它将被归档到`docs/mhp/`目录，作为决策上下文的快照。

**命名规范**: `VOI-{任务ID}_{任务简称}.md`  
**示例**: `VOI-6_world_morphing.md`
`
MHP是“管理者Manus”在完成一次规划会话后，必须生成的结构化文档。它将被附加到相关Jira Epic的评论区，作为决策上下文的快照。
```markdown
# Manus工作交接协议 (MHP)

**协议版本**: 1.0
**生成时间**: [ISO 8601 Format Timestamp]
**关联Jira Epic/Story**: [JIRA-ID]

---

### 1. 核心目标 (Objective)
*   本次会话目标: ...
*   最终决策: ...

---

### 2. 上下文来源 (Context Sources)
*   主要参考Notion文档: ...
*   关键用户输入 (摘要): ...

---

### 3. Jira变更摘要 (Jira Changeset)
*   创建/更新的Epic: ...
*   创建的Stories/Tasks: ...
*   任务依赖关系: ...

---

### 4. 待办事项与下一步建议 (Actionable Next Steps)
*   立即指派给开发者的任务: ...
*   需要您决策的事项: ...
*   未来规划: ...

---
```


## 7. 三阶段提示词体系

为了解决长对话中上下文遗忘的问题，我们引入三阶段提示词体系。这套体系确保在对话的不同阶段，Manus都能被重新“锚定”到核心规范和任务目标上，从而保证产出的一致性和准确性。

### 7.1. 阶段一：初始交接提示词 (Initial Handover Prompt)

**用途**: 在新对话开始时，用于引导一个新的Manus实例完整加载项目上下文。

### 7.2. 阶段二：中期更新提示词 (Mid-session Update Prompt)

**用途**: 在长对话进行到中途，需要Manus进行文档撰写、代码提交等关键操作时，用于重新强调规范，防止上下文遗忘。

### 7.3. 阶段三：最终交接提示词 (Final Handover Prompt)

**用途**: 在当前对话即将结束时，用于指令Manus生成并提交完整的交接文档，为下一任Manus对话做准备。

详细的模板和使用流程，请参考`docs/three_stage_prompt_templates.md`文件。


**核心内容**：
- **核心指令**: 明确下一位Manus的角色和首要职责
- **上下文加载指南**: 详细说明如何从GitHub仓库加载规范文档
- **当前任务分配**: 指定任务ID和任务链接
- **任务目标**: 说明需要与用户讨论的技术方案
- **预期产出**: 明确需要创建的交付物和更新的任务状态
- **关键资源**: 提供GDD、附录和MHP的链接
- **三阶段提示词**: 提供完整的初始交接、中期更新和最终交接提示词


**核心内容**：
- **核心指令**: 明确下一位Manus的角色和首要职责
- **上下文加载指南**: 详细说明如何从GitHub仓库加载规范文档
- **当前任务分配**: 指定任务ID和任务链接
- **任务目标**: 说明需要与用户讨论的技术方案
- **预期产出**: 明确需要创建的交付物和更新的任务状态
- **关键资源**: 提供GDD、附录和MHP的链接
- **下一步任务**: 根据任务完成情况，提供下一个任务或当前任务的“阶段一：初始交接提示词”
- **三阶段提示词**: 提供完整的初始交接、中期更新和最终交接提示词


## 8. 项目入职提示词 (Project Onboarding Prompt)

### 8.1. 核心理念

除了用于执行具体任务的“交接文档”外，我们还建立了一套“项目入职提示词”，用于引导一个全新的、不了解项目的Manus实例，使其能够快速、全面地了解项目，并基于理解主动为项目“添砖加瓦”——即提出有价值的建议，并创建新的Linear任务。

这与“接手任务”的交接文档不同，它的核心目标是 **从0到1的贡献**，而非从1到N的执行。

### 8.2. 角色定义

使用此提示词的Manus实例，其角色被定义为 **“项目策略师Manus” (Project Strategist Manus)**。其职责包括：

*   **项目分析师**: 深入理解项目的设计、规范和现状。
*   **创意贡献者**: 提出新的功能、改进建议或优化方案。
*   **任务规划师**: 将可行的建议转化为结构化的Linear任务。

### 8.3. 使用场景

当您希望获得关于项目的全新视角、寻找新的开发方向，或者需要规划下一阶段的工作时，就可以在一个新的对话中，使用“项目入职提示词”来启动一个“项目策略师Manus”。

完整的提示词模板请参见 `docs/project_onboarding_prompt.md`。
